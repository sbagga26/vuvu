3

√´¬¥\(  √£               @   sP   d dl mZ d dlZd dlmZmZmZ d dlm	Z	 d dl
Z
G dd‚Äû de∆íZdS )√©    )√öAPIViewN)√ö	connectDB√ö
error_logging√öinsert_into_db)√öJsonResponsec               @   s   e Zd Zdd‚Äû Zdd‚Äû ZdS )√öPortal_Mappingc             C   s~   t ∆í }y4t∆í }tjd|∆í}|jj∆í }tddtt|∆í∆íii∆íS  t	k
rx } z"|j
t|∆í∆í tddt|∆íii∆íS d}~X nX dS )z3

        :param request:
        :return:
        z&select * from Portals_Category_tagging√öOutputZ
columns_names√öErrorN)r   r   √öpd√öread_sql_query√öcolumns√ö
get_valuesr   √ölist√öset√ö	Exception√öerror√östr)√öself√örequest√ölogger√öengine√ödestination_table_df√ödestination_table_columns√öe¬© r   √∫!/home/tatald/lnd/mapping/views.py√öget	   s    
zPortal_Mapping.getc             C   s√é  t |j∆í t∆í }¬êyv|jd }|dkrb|jd }t |j∆í tj|∆í}|jj∆í }tdtt	|∆í∆íi∆íS |dkr√Æ|jd }|jd }tj|∆í}|j
d∆í}|j|dd¬ç}t|∆ís¬∏td	d
dii∆íS t∆í }x|D ]}	|j
||	 ∆í q√ÑW t|| dd
d¬ç}
n≈í|dk¬êrz|jd }t∆í }tjd|∆í}
|
jj∆í }tjt∆í}x0|D ](}x |D ]}|| j
|| ∆í ¬êq8W ¬êq.W t |∆í tj|∆í}t|dd
d¬ç}
td	d
|
ii∆íS  tk
¬êr√à } z"|jt|∆í∆í td	dt|∆íii∆íS d }~X nX d S )N√ö	post_typeZ
parse_file√öfileZuploaded_file_columnsZ
final_mapping√ö r   )Zaxisr   ZResponsezNo data to insert√©d   ZPortals_Category_tagging)√ödf√ö
chunk_size√ö
table_name√ö	form_dataz&select * from Portals_Category_taggingr	   )√öprint√ödatar   r
   Zread_csvr   r
   r   r   r   Zfillna√örename√ölen√öappendr   r   r   √öcollections√ödefaultdictZ	DataFramer   r   r   )r   r   r   r   Z	data_fileZdata_dfZdata_file_columnsZmappingsZcolumn_to_be_included√ömapping√öoutputr&   r   r   r   Ztemp_form_data√öcolumnr$   Zform_data_dfr   r   r   r   √öpost   sN    



















zPortal_Mapping.postN)√ö__name__√ö
__module__√ö__qualname__r   r/   r   r   r   r   r      s   r   )Zrest_framework.viewsr   Zpandasr
   Zlnd.baser   r   r   √ödjango.httpr   r*   r   r   r   r   r   √ö<module>   s
   
